@model SessionViewModel
@{
    ViewBag.LayoutView = LayoutPage.Client;
    ViewBag.ViewTitle = Labels.viewTitle_CaseSessionEdit;
    
}

@Html.Partial("_ValidationSummaryOuter")


<ul class="nav nav-tabs" role="tablist">
    <li class="active">
		<a class="tabButton" href="#Details" role="tab" data-toggle="tab">@Labels.Details</a>
	</li>
	<li>
		<a class="tabButton" href="#Appointments" role="tab" data-toggle="tab">@Labels.Appointments</a>
	</li>
	<li>
		<a class="tabButton" href="#Comments" role="tab" data-toggle="tab">@Labels.Comments</a>
	</li>
</ul>

<!-- Tab panes -->
<div class="panel panel-default border-top-fix-tabs">
	<div class="panel-body">
		<div class="tab-content">
            <div class="tab-pane active" id="Details" style="padding: 10px;">
                <div class="displayView">
                    <div class="col-sm-12 col-md-12 col-lg-12">
                        @using (Html.BeginForm("EditMeeting", "CaseManagement", FormMethod.Post, new { @class = "form-horizontal" }))
                        {
                            @Html.AntiForgeryToken()
                            @Html.HiddenFor(model => model.CaseID)
                            @Html.HiddenFor(model => model.SessionID)
                            @Html.HiddenFor(model => model.ReadOnlyVitals.ClientID)
                            @Html.HiddenFor(model => model.DesiredOutcomeTypeID)
                            @Html.HiddenFor(model => model.OrganizationID)

                            @Html.Partial("_BaseHiddenFor", Model)

                            <div class="row">
                                <div class="form-group">
                                    @Html.HifisLabelFor(model => model.DesiredOutcomeTypeID, new { @class = "col-sm-3 control-label" })
                                    <div class="col-sm-9" style="margin-top:7px;">
                                        <strong>
                                            @WebHelper.GetTextFromCache(CachedTableTypes.HIFIS_DesiredOutcomeTypes,
                                                Culture, Model.DesiredOutcomeTypeID)
                                        </strong>
                                    </div>
                                </div>

                            </div>

                            @*if appointment exists then disable the Activity drop down*@
                            if (Model.Appointments != null && Model.Appointments.Count > 0)
                            {
                                <div class="row">
                                    <div class="form-group">
                                        @Html.HiddenFor(model => model.SessionActivityID)
                                        @Html.HifisLabelFor(model => model.SessionActivityName, new { @class = "col-sm-3 control-label" })
                                        <div class="col-sm-9" style="margin-top:7px;">
                                            <strong>@Model.SessionActivityName</strong>
                                        </div>
                                    </div>
                                </div>
                            }
                            else
                            {
                                <div class="row">
                                    @Html.HifisEditorFor(model => model.SessionActivityID, ViewBag.Activities as SelectList)
                                </div>
                            }

                            <div class="row">
                                @Html.HifisTextAreaFor(model => model.SessionDescription, new { @class = "commentBoxSize" })
                            </div>

                            <div class="row">
                                @Html.HifisEditorFor(model => model.SessionDate, "DateAndTime")
                            </div>

                            <div class="row col-sm-offset-2">
                                <strong>@Labels.ExpendedTime</strong>
                            </div>

                            <div class="row">
                                @Html.HifisEditorFor(model => model.Hours)
                            </div>

                            <div class="row">
                                @Html.HifisEditorFor(model => model.Minutes)
                            </div>

                            <div class="row">
                                @Html.HifisEditorFor(model => model.CaseWorkerID, ViewBag.CaseWorker as SelectList)

                                @Html.ValidationImageFor(model => model.CaseWorkerID)
                            </div>

                            <div class="row">
                                @Html.HifisEditorFor(model => model.ResponsibilityTypeID, CachedTableTypes.HIFIS_ResponsibilityTypes)
                            </div>

                            <div class="row">
                                @Html.HifisEditorFor(model => model.ReferralTypeID, CachedTableTypes.HIFIS_ReferrerCategTypes)
                            </div>

                            <div class="row">
                                @Html.HifisEditorFor(m => m.ClientPresent, "YesNo")
                            </div>

                            <div class="row">
                                @Html.HifisEditorFor(m => m.FamilyPresent, "YesNo")
                            </div>

                            <div class="row form-group">
                                <div class="col-sm-offset-2 col-sm-10">
                                    <button type="submit" class="saveButton  ">@Labels.Save</button>
                                    @Html.ActionLink(Labels.Cancel, "Edit", "CaseManagement",
                                        new { caseID = Model.CaseID, id = Model.ReadOnlyVitals.ClientID }, new { @class = "cancelButton", alt = Labels.Cancel, aria_label = Labels.Cancel, @role = "button" })
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>

			<div class="tab-pane" id="Appointments" style="padding: 10px;">
				<div class="table-responsive">
                    <table class="wb-tables table table-striped table-hover" data-wb-tables='{ "info": false }'>
					    <thead>
						    <tr>
							    <th>@Labels.AppointmentDate</th>
							    <th>@Labels.AppointmentTime</th>
							    <th>@Labels.Description</th>
							    <th>@Labels.Action</th> 
						    </tr>
					    </thead>                                     
					    <tbody>
						    @if (!Model.Appointments.IsEmptyOrNull())
                            {
                                for (int i = 0; i < Model.Appointments.Count; i++)
                                {
								    <tr>
									    <td>@Model.Appointments[i].Appointment.StartDateTime.ToString("yyyy-MM-dd")</td>
									    <td>@DateHelper.TimeFormaterENFR(Model.Appointments[i].Appointment.StartDateTime, Labels.CurrentCulture)</td>
									    <td>@Html.DisplayFor(m => m.Appointments[i].Appointment.Description)</td>
									    <td class="nowrap">
                                            @if (RightsHelper.HasRight(UserRights.CaseManagement_Sessions_Appointment_Display, Model.OrganizationID))
                                            { 
											    @Html.ActionLink(Labels.Display, "DisplayMeetingAppointment", "CaseManagement", 
                                                    new { sessionAppointmentID = Model.Appointments[i].SessionAppointmentID, 
                                                          sessionID = Model.Appointments[i].SessionID, caseID = Model.Appointments[i].CaseID, 
                                                          id = Model.ReadOnlyVitals.ClientID, goalID = Model.DesiredOutcomeTypeID, 
                                                          goalDesc = WebHelper.GetTextFromCache(CachedTableTypes.HIFIS_DesiredOutcomeTypes, 
                                                            Culture, Model.DesiredOutcomeTypeID) }, new { @class = "displayButton noText", alt=Labels.Display, aria_label = Labels.Display, @role = "button" })
                                            }

										    @if (RightsHelper.HasRight(UserRights.CaseManagement_Sessions_Appointment_Edit, Model.OrganizationID))
                                            { 
											    @Html.ActionLink(Labels.Edit, "EditMeetingAppointment", "CaseManagement", 
                                                    new { sessionAppointmentID = Model.Appointments[i].SessionAppointmentID, 
                                                          sessionID = Model.Appointments[i].SessionID, caseID = Model.Appointments[i].CaseID, 
                                                          id = Model.ReadOnlyVitals.ClientID, goalID = Model.DesiredOutcomeTypeID, 
                                                          goalDesc = WebHelper.GetTextFromCache(CachedTableTypes.HIFIS_DesiredOutcomeTypes, 
                                                            Culture, Model.DesiredOutcomeTypeID) }, new { @class = "editButton noText", alt=Labels.Edit, aria_label=Labels.Edit, @role = "button" })
                                            }
											
										    @if (RightsHelper.HasRight(UserRights.CaseManagement_Sessions_Appointment_Delete, Model.OrganizationID))
                                            { 
											    @Html.ActionLink(Labels.Delete, "DeleteMeetingAppointment", "CaseManagement", 
                                                    new { id = Model.ReadOnlyVitals.ClientID, 
                                                          pAppointmentID = Model.Appointments[i].Appointment.AppointmentID }, 
                                                          new { @class = "deleteButton noText", alt=Labels.Delete, aria_label=Labels.Delete, @role = "button" })
                                            } 
									    </td>
								    </tr>
                                }
                            }
					    </tbody>
				    </table>
				</div>
				<div class="clearfix"></div>
				<div class="mrgn-tp-md mrgn-bttm-md">
					@if (RightsHelper.HasRight(UserRights.CaseManagement_Sessions_Appointment_Add, Model.OrganizationID))
                    { 
						@Html.ActionLink(Labels.NewAppointment, "NewMeetingAppointment", "CaseManagement", 
                            new { sessionID = Model.SessionID, caseID = Model.CaseID, id = Model.ReadOnlyVitals.ClientID, 
                                  goalID = Model.DesiredOutcomeTypeID, 
                                  goalDesc = WebHelper.GetTextFromCache(CachedTableTypes.HIFIS_DesiredOutcomeTypes, Culture, 
                                  Model.DesiredOutcomeTypeID) }, new { @class = "addButton", alt=Labels.NewAppointment, aria_label=Labels.NewAppointment, @role = "button" })
                    }
				</div>
			</div>

			<div class="tab-pane" id="Comments" style="padding: 10px;">
				<div class="table-responsive">
                    <table class="wb-tables table table-striped table-hover" data-wb-tables='{ "info": false }'>
					    <thead>
						    <tr>
							    <th>
                                    @Labels.Date
							    </th>
							    <th>
                                    @Labels.User
							    </th>
							    <th>
                                    @Labels.Subject
							    </th>
							    <th>
                                    @Labels.Action
							    </th>
						    </tr>
					    </thead>
					    <tbody>
						    @if (Model.SessionComments != null && Model.SessionComments.Count > 0)
                            {
                                for (int i = 0; i < Model.SessionComments.Count; i++)
                                {
								    <tr>
									    <td>
                                            @(Model.SessionComments[i].CreatedDate.HasValue && 
                                              Model.SessionComments[i].CreatedDate.Value != default(DateTime) ? 
                                              Model.SessionComments[i].CreatedDate.Value.ToString("yyyy-MM-dd") : 
                                              Model.SessionComments[i].DateCreated.ToString("yyyy-MM-dd"))
									    </td>
									    <td>
                                            @Html.DisplayFor(m => m.SessionComments[i].UserName)
									    </td>
									    <td>
                                            @Html.DisplayFor(m => m.SessionComments[i].Subject)
									    </td>
									    <td class="text-center">
                                            @if (RightsHelper.HasRight(UserRights.CaseManagement_Sessions_Comment_Display, Model.OrganizationID))
                                            { 
                                                @Html.ActionLink(Labels.Display, "DisplayMeetingComment", "CaseManagement", 
                                                    new { sessionCommentID = Model.SessionComments[i].SessionCommentID, caseID = Model.CaseID, 
                                                          goalID = Model.DesiredOutcomeTypeID, id = Model.ReadOnlyVitals.ClientID }, 
                                                    new { @class = "displayButton noText", alt=Labels.Display, aria_label=Labels.Display, @role = "button" })
                                            }
												
										    @if (RightsHelper.HasRight(UserRights.CaseManagement_Sessions_Comment_Edit, Model.OrganizationID))
                                            { 
											    @Html.ActionLink(Labels.Edit, "EditMeetingComment", "CaseManagement", 
                                                    new { sessionCommentID = Model.SessionComments[i].SessionCommentID, caseID = Model.CaseID, 
                                                          goalID = Model.DesiredOutcomeTypeID, id = Model.ReadOnlyVitals.ClientID }, 
                                                    new { @class = "editButton noText", alt=Labels.Edit, aria_label=Labels.Edit, @role = "button" })
                                            }
												
										    @if (RightsHelper.HasRight(UserRights.CaseManagement_Sessions_Comment_Delete, Model.OrganizationID))
                                            { 
											    @Html.ActionLink(Labels.Delete, "DeleteMeetingComment", "CaseManagement", 
                                                    new { id = Model.ReadOnlyVitals.ClientID, commentID = Model.SessionComments[i].CommentsID }, 
                                                    new { @class = "deleteButton noText", alt=Labels.Delete, aria_label=Labels.Delete, @role = "button" })
                                            }
									    </td>
								    </tr>
                                }
                            }
					    </tbody>
                    </table>
				</div>

				<div class="clearfix"></div>

                <div class="row mrgn-tp-md mrgn-bttm-md">
                    @if (RightsHelper.HasRight(UserRights.CaseManagement_Sessions_Comment_Add, Model.OrganizationID))
                    { 
                        @Html.ActionLink(Labels.NewComment, "NewMeetingComment", "CaseManagement", 
                            new { id = Model.ReadOnlyVitals.ClientID, sessionID = Model.SessionID, cseID = Model.CaseID, 
                                  goalID = Model.DesiredOutcomeTypeID }, new { @class = "addButton", alt=Labels.NewComment, aria_label=Labels.NewComment, @role = "button" })
                    }
                </div>
			</div>
		</div>	
	</div>
</div>

<div>@Html.Partial("_BaseFooter", (BaseViewModel)Model)</div>
