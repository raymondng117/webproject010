@model TurnawayListViewModel
@{
    ViewBag.ViewTitle = Labels.viewTitle_TurnAways;
    
    ViewBag.LayoutView = LayoutPage.ContentOnly;

    int i = 1;
}

@Html.Partial("_ValidationSummaryOuter")


<div>
    @* To use datefilter add datefilterviewmodel to the vm being used, then copy section below and paste at top of list view.
     Then copy the commented js from _DateFilterList.cshtml and change controller names to appropriate values *@
    @Html.Partial("_DateFilterList", Model.DateFilter)
    <div class="clearfix"></div>
    <br />
    
    <div class="table-responsive">
        <table class="wb-tables table table-striped table-hover" data-wb-tables='{ "info": false }'>
            <thead>
                <tr>
                    <th class="col-xs-2">@Labels.ClientFullName</th>
                    <th class="col-xs-2">@Labels.Family</th>
                    <th class="col-xs-2">@Labels.DateAndTimeOfTA</th>
                    <th class="col-xs-2">@Labels.ReasonForService</th>
                    <th class="col-xs-2">@Labels.ReasonForTA</th>
                    <th class="col-xs-2">@Labels.Action</th>
                </tr>
            </thead>
            <tbody>
                @foreach (TurnawayViewModel item in Model.Turnaways.ToList())
                {      
                    <tr>
                        <td>@Html.ActionLink((item.PrimaryClientLastName + ", " + item.PrimaryClientFirstName), "DisplayVitals", "ClientTombstone", new { id = item.PrimaryClientID }, new { alt = (item.PrimaryClientLastName + ", " + item.PrimaryClientFirstName), aria_label = (item.PrimaryClientLastName + ", " + item.PrimaryClientFirstName) })</td>
                        <td>
                            @if (item.ClientsFamily.Count() > 1)
                            {
                                <div class="panel-default">
                                    <div class="pddng-lft-0 pddng-rght-15 pddng-tp-0 pddng-bttm-0">
                                        <a data-toggle="collapse" data-parent="#accordion" href="#@i" class="btn btn-default btn-sm btn-block" style="text-align:left;"> 
                                            @item.ClientsFamily.Count() @Labels.FamilyMembers 
                                            <span class="caret pull-right mrgn-tp-sm"></span>
                                        </a>
                                    </div>
                                    <div id="@i" class="panel-collapse collapse">
                                            <ul class="pddng-lft-md">
                                                @foreach (var client in item.ClientsFamily)
                                                {                            
                                                    <li>@Html.ActionLink(client.ClientFullName, "DisplayVitals", "ClientTombstone", new { id = client.ClientID }, new { alt = client.ClientFullName, aria_label = client.ClientFullName })</li>
                                                }
                                            </ul>
                                        </div>
                                    </div>
                                i++;
                            }
                        
                            @if (item.ClientsFamily.Count() == 1)
                            {
                                foreach (var client in item.ClientsFamily)
                                {                            
                                    @Html.ActionLink(client.ClientFullName, "DisplayVitals", "ClientTombstone", new { id = client.ClientID }, new { alt = client.ClientFullName, aria_label = client.ClientFullName })
                                }
                            }  
                        </td>
                        <td class="align-center">@DateHelper.DateTimeFormaterENFR(item.EffectiveDT, Labels.CurrentCulture)</td>
                        <td>@WebHelper.GetTextFromCache(CachedTableTypes.HIFIS_ReasonForServiceTypes, Culture, item.ReasonForServiceTypeID)</td>
                        <td>@WebHelper.GetTextFromCache(CachedTableTypes.HIFIS_ReasonsForTurnawayTypes, Culture, item.ReasonsForTurnawayTypeID)</td>
                        <td class="align-center">
                        
                            @if (RightsHelper.HasRight(UserRights.Turnaways_Display))
                            {
                                @Html.ActionLink(Labels.Display, "Display", "Turnaways", new { id = item.PrimaryClientID, turnawayID = item.TurnawayID }, new { @class = "displayButton noText", alt=Labels.Display, aria_label = Labels.Display, @role = "button" })
                            }
                        
                            @if (RightsHelper.HasRight(UserRights.Turnaways_Edit))
                            {
                                @Html.ActionLink(Labels.Edit, "Edit", "Turnaways", new { id = item.PrimaryClientID, turnawayID = item.TurnawayID}, new { @class = "editButton noText", alt=Labels.Edit, aria_label = Labels.Edit, @role = "button" })
                            }
                        
                            @if (RightsHelper.HasRight(UserRights.Turnaways_Delete))
                            {
                                @Html.ActionLink(Labels.Delete, "Delete", "Turnaways", new { id = item.PrimaryClientID, turnawayID = item.TurnawayID }, new { @class = "deleteButton noText", alt=Labels.Delete, aria_label = Labels.Delete, @role = "button" })
                            }
                        
                        </td>
                    </tr>   
                }
            </tbody>
        </table>
    </div>

    <div class="clearfix"></div>

    <div class="mrgn-tp-md">
        @if (RightsHelper.HasRight(UserRights.Turnaways_Add))
        {        
            @Html.ActionLink(Labels.AddTurnAway, "New", "Turnaways", null, new { @class = "addButton mrgn-rght-xs", alt=Labels.AddTurnAway, aria_label = Labels.AddTurnAway, @role = "button" })
            @Html.ActionLink(Labels.LayoutAnonymous, "NewAnonymous", "Turnaways", null, new { @class = "addButton", alt=Labels.LayoutAnonymous, aria_label = Labels.LayoutAnonymous, @role = "button" })
        }        
    </div>
</div>